frontend http_front
    bind *:80
    option forwardfor
    reqadd X-Forwarded-Proto:\ http
    use_backend %[req.hdr(host),lower,map(/etc/haproxy/backend.map)]

frontend https_front
    bind *:443 ssl crt /etc/ssl/certs/haproxy.pem
    reqadd X-Forwarded-Proto:\ https
    use_backend %[req.hdr(host),lower,map(/etc/haproxy/backend.map)]

backend default_backend
    server server1 127.0.0.1:80
